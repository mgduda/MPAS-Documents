\chapter{Model Options}
\label{chap:mpas_options}

Beyond the basic process of running a global simulation with standard output files outlined
in Chapter \ref{chap:running_mpas_a}, the MPAS-Atmosphere model provides several options
that can be described in terms of variations on the basic simulation workflow. In the sections
that follow, major model options are described in terms of the deviation from basic global
simulation process.


\section{Periodic SST and Sea-ice Updates}
\label{sec:sst_update}

The stand-alone MPAS-Atmosphere model is not coupled to fully prognostic ocean or sea-ice models,
and accordingly, the model SST and sea-ice fraction fields will in general not change over
the course of a simulation. For simulations shorter than a few days, invariant SST and sea-ice
fraction fields will generally not be problematic. However, for longer model simulations, it is
generally recommended to periodically update the SST and sea-ice fields from an external file.

The surface data to be used for periodic SST and sea-ice updates could originate from any number
of sources, though the most straightforward way to obtain a dataset in a usable format is to process
GRIB data (e.g., GFS GRIB data) with the {\em ungrib} program of the WRF model's pre-processing system(WPS).
Detailed instructions for building and running the WPS, and the process of generating intermediate data
files from GFS data, can be found in Chapter 3 of the WRF User Guide:
\url{http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.1/users_guide_chap3.html}.

The following steps summarize the generation of an SST and sea-ice update file, {\tt surface.nc}, using
the {\tt init\_atmosphere\_model} program:

\begin{itemize}
\item Include surface data intermediate files in the working directory
\item Include a {\tt static.nc} file in the working directory (Section \ref{sec:atm_real_static})
\item If running in parallel, include a {\tt graph.info.part.*} in the working directory (Section \ref{sec:metis})
\item Edit the {\tt namelist.init\_atmosphere} configuration file (see below)
\item Edit the {\tt streams.init\_atmosphere} I/O configuration file (described below)
\item Run {\tt init\_atmosphere\_model} to create {\tt surface.nc}
\end{itemize}


\begin{longtable}{p{3.0in} |p{3.25in}}

\&nhyd\_model\\
   \namelist{inl:config_init_case}       = 8                      & must be 8, the surface field initialization case \\
   \namelist{inl:config_start_time}      = '2010-10-23\_00:00:00' & time to begin processing surface data \\
   \namelist{inl:config_stop_time}       = '2010-10-30\_00:00:00' & time to end processing surface data \\
/\\
\\
\&data\_sources\\
   \namelist{inl:config_sfc_prefix}      = 'SST'                  & the prefix of the intermediate data files containing SST and sea-ice \\
   \namelist{inl:config_fg_interval}     = 86400                  & interval between intermediate files to use for SST and sea-ice \\
/\\
\\
\\
\&preproc\_stages                                    & only the input\_sst and frac\_seaice stages \\
   \namelist{inl:config_static_interp}   = false                & should be enabled \\
   \namelist{inl:config_native_gwd_static} = false           & \\
   \namelist{inl:config_vertical_grid}   = false                & \\
   \namelist{inl:config_met_interp}      = false                & \\
   \namelist{inl:config_input_sst}       = true                 & \\
   \namelist{inl:config_frac_seaice}    = true                 & \\
/\\
\\
\&decomposition\\
   \namelist{inl:config_block_decomp_file_prefix} = 'graph.info.part.' & if running in parallel, needs to match the grid decomposition file prefix \\
/\\

\end{longtable}

After editing the {\tt namelist.init\_atmosphere} namelist file, the name of the static file, as well as the name of the surface update file to be created, must be set in the XML I/O configuration file, {\tt streams.init\_atmosphere}. Specifically, the {\tt filename\_template} attribute must be set to the name of the static file in the {\tt "input"} stream definition, and the {\tt filename\_template} attribute must be set to name of the surface update file to be created in the {\tt "surface"} stream definition. {\em Also, for the ``surface'' stream, ensure that the ``output\_interval'' attribute is set to the interval at which the surface intermediate files are provided.}


\section{Regional Simulation}
\label{sec:regional}

New in MPAS v7.0 is the capability to run simulations over regional domains on the surface of the sphere. Setting up and running
a limited-area simulation requires as a starting point a limited-area SCVT mesh, described in section \ref{sec:mesh_subset}. Given
a limited-area mesh, the key differences from a global simulation are:

\begin{itemize}
\item the blending of the MPAS terrain field with the ``first-guess'' terrain data along the boundaries of the limited-area
domain;
\item the generation of a set of files containing lateral boundary conditions (LBCs); and
\item the application of LBCs during the model integration.
\end{itemize}

The first of these differences -- the blending of terrain data -- takes place when generating the limited-area initial conditions.
Limited-area initial conditions are prepared as in \ref{sec:atm_real_met}, except that the \namelist{inl:config_blend_bdy_terrain}
option should be set to {\tt true} in the {\tt namelist.init\_atmosphere} file. This option instructs the {\tt init\_atmosphere\_model}
program to perform averaging of the model terrain field from the {\tt static.nc} file with the terrain field from the atmospheric
initial conditions dataset along the lateral boundaries of the mesh.

The second difference -- the generation of LBC files -- requires running the {\tt init\_atmosphere\_model} program one additional
time, with namelist options set as described below.

\begin{longtable}{p{3.0in} |p{3.25in}}

\&nhyd\_model\\
   \namelist{inl:config_init_case}       = 9                      & the LBCs processing case \\
   \namelist{inl:config_start_time}      = '2010-10-23\_00:00:00' & time to begin processing LBC data \\
   \namelist{inl:config_stop_time}       = '2010-10-30\_00:00:00' & time to end processing LBC data \\
/\\
\\
\&dimensions\\
   \namelist{inl:config_nfglevels}      = 38                      & number of vertical levels in intermediate file \\
/\\
\\
\&data\_sources\\
   \namelist{inl:config_met_prefix}      = 'GFS'                  & the prefix of intermediate data files to be used for LBCs \\
   \namelist{inl:config_fg_interval}     = 10800                  & interval between intermediate files \\
/\\
\\
\&decomposition\\
   \namelist{inl:config_block_decomp_file_prefix} = 'graph.info.part.' & if running in parallel, needs to match the grid decomposition file prefix \\
/\\

\end{longtable}

\noindent When running the LBC processing case, the {\tt output\_interval} for the ``lbc'' stream in the {\tt
streams.init\_atmosphere} file must be set to match the value of \namelist{inl:config_fg_interval} in
the {\tt namelist.init\_atmosphere} file. Additionally, the file to be read by the ``input'' stream must contain
vertical grid information; typically, the model initial-conditions file can be used as the source for the ``input'' stream.
The end result of the LBC processing case should be a set of netCDF files containing LBCs for the model integration.

The final difference -- application of LBCs during the model integration -- simply requires setting \namelist{mnl:config_apply_lbcs}
to {\tt true} in the model's {\tt namelist.atmosphere} file, as well as setting the {\tt input\_interval} for the ``lbc\_in'' stream
in the {\tt streams.atmosphere} file to match the interval at which the LBC netCDF files were produced.

%
%\section{Sounding Output}
%\label{sec:soundings}
%
%Describe use of `soundings.txt' file and namelist to obtain periodic soundings at specified locations.
%
%
%\section{Incremental Analysis Update}
%\label{sec:iau}
%
%Describe operation of incremental analysis update.
